{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/LENOVO/tinylink/TinyLink/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\ndeclare global {\r\n  // allow global prisma during dev to avoid multiple instances\r\n  // eslint-disable-next-line no-var\r\n  var prisma: PrismaClient | undefined;\r\n}\r\n\r\nconst prisma = global.prisma ?? new PrismaClient();\r\nif (process.env.NODE_ENV !== 'production') global.prisma = prisma;\r\n\r\nconst CODE_REGEX = /^[A-Za-z0-9]{6,8}$/;\r\n\r\nfunction genCode(length = 6) {\r\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n  let s = '';\r\n  for (let i = 0; i < length; i++) s += chars[Math.floor(Math.random() * chars.length)];\r\n  return s;\r\n}\r\n\r\nfunction ensureValidUrl(url: string) {\r\n  try {\r\n    // allow relative? spec requires full URL â€” validate absolute only\r\n    const u = new URL(url);\r\n    return u.toString();\r\n  } catch {\r\n    throw new Error('INVALID_URL');\r\n  }\r\n}\r\n\r\nexport async function createLink({ url, code }: { url: string; code?: string }) {\r\n  const safeUrl = ensureValidUrl(url);\r\n\r\n  let finalCode = code?.trim();\r\n  if (finalCode) {\r\n    if (!CODE_REGEX.test(finalCode)) throw new Error('INVALID_CODE');\r\n    const existing = await prisma.link.findUnique({ where: { code: finalCode } });\r\n    if (existing) throw new Error('CODE_EXISTS');\r\n  } else {\r\n    // generate until unique (rare collision)\r\n    let attempts = 0;\r\n    do {\r\n      finalCode = genCode(6);\r\n      const exists = await prisma.link.findUnique({ where: { code: finalCode } });\r\n      if (!exists) break;\r\n      attempts++;\r\n    } while (attempts < 5);\r\n  }\r\n\r\n  const created = await prisma.link.create({\r\n    data: {\r\n      code: finalCode!,\r\n      url: safeUrl,\r\n    },\r\n  });\r\n\r\n  return created;\r\n}\r\n\r\nexport async function getLinks() {\r\n  return prisma.link.findMany({\r\n    orderBy: { createdAt: 'desc' },\r\n  });\r\n}\r\n\r\nexport async function getLinkByCode(code: string) {\r\n  return prisma.link.findUnique({ where: { code } });\r\n}\r\n\r\nexport async function deleteLink(code: string) {\r\n  // will throw if not found\r\n  return prisma.link.delete({ where: { code } });\r\n}\r\n\r\nexport async function incrementClick(code: string) {\r\n  return prisma.link.update({\r\n    where: { code },\r\n    data: {\r\n      clicks: { increment: 1 },\r\n      lastClicked: new Date(),\r\n    },\r\n  });\r\n}\r\n\r\nexport { prisma };"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAQA,MAAM,SAAS,OAAO,MAAM,IAAI,IAAI,6IAAY;AAChD,wCAA2C,OAAO,MAAM,GAAG;AAE3D,MAAM,aAAa;AAEnB,SAAS,QAAQ,SAAS,CAAC;IACzB,MAAM,QAAQ;IACd,IAAI,IAAI;IACR,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,IAAK,KAAK,KAAK,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,MAAM,MAAM,EAAE;IACrF,OAAO;AACT;AAEA,SAAS,eAAe,GAAW;IACjC,IAAI;QACF,kEAAkE;QAClE,MAAM,IAAI,IAAI,IAAI;QAClB,OAAO,EAAE,QAAQ;IACnB,EAAE,OAAM;QACN,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,eAAe,WAAW,EAAE,GAAG,EAAE,IAAI,EAAkC;IAC5E,MAAM,UAAU,eAAe;IAE/B,IAAI,YAAY,MAAM;IACtB,IAAI,WAAW;QACb,IAAI,CAAC,WAAW,IAAI,CAAC,YAAY,MAAM,IAAI,MAAM;QACjD,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,MAAM;YAAU;QAAE;QAC3E,IAAI,UAAU,MAAM,IAAI,MAAM;IAChC,OAAO;QACL,yCAAyC;QACzC,IAAI,WAAW;QACf,GAAG;YACD,YAAY,QAAQ;YACpB,MAAM,SAAS,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;gBAAE,OAAO;oBAAE,MAAM;gBAAU;YAAE;YACzE,IAAI,CAAC,QAAQ;YACb;QACF,QAAS,WAAW,EAAG;IACzB;IAEA,MAAM,UAAU,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC;QACvC,MAAM;YACJ,MAAM;YACN,KAAK;QACP;IACF;IAEA,OAAO;AACT;AAEO,eAAe;IACpB,OAAO,OAAO,IAAI,CAAC,QAAQ,CAAC;QAC1B,SAAS;YAAE,WAAW;QAAO;IAC/B;AACF;AAEO,eAAe,cAAc,IAAY;IAC9C,OAAO,OAAO,IAAI,CAAC,UAAU,CAAC;QAAE,OAAO;YAAE;QAAK;IAAE;AAClD;AAEO,eAAe,WAAW,IAAY;IAC3C,0BAA0B;IAC1B,OAAO,OAAO,IAAI,CAAC,MAAM,CAAC;QAAE,OAAO;YAAE;QAAK;IAAE;AAC9C;AAEO,eAAe,eAAe,IAAY;IAC/C,OAAO,OAAO,IAAI,CAAC,MAAM,CAAC;QACxB,OAAO;YAAE;QAAK;QACd,MAAM;YACJ,QAAQ;gBAAE,WAAW;YAAE;YACvB,aAAa,IAAI;QACnB;IACF;AACF"}},
    {"offset": {"line": 159, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/LENOVO/tinylink/TinyLink/app/api/links/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { createLink, getLinks } from '../../../lib/db';\n\nexport async function POST(request: Request) {\n  const body = await request.json().catch(() => ({}));\n  const longUrl = body.longUrl ?? body.url ?? body.long_url ?? '';\n  const customCode = body.customCode ?? body.code ?? body.custom_code;\n\n  if (!longUrl || String(longUrl).trim() === '') {\n    return NextResponse.json({ error: 'Long URL is required' }, { status: 400 });\n  }\n\n  try {\n    const link = await createLink({ url: longUrl, code: customCode });\n    return NextResponse.json(link, { status: 201 });\n  } catch (err: any) {\n    if (err.message === 'CODE_EXISTS') {\n      return NextResponse.json({ error: 'Code already exists' }, { status: 409 });\n    }\n    if (err.message === 'INVALID_URL' || err.message === 'INVALID_CODE') {\n      return NextResponse.json({ error: err.message }, { status: 400 });\n    }\n    return NextResponse.json({ error: 'Server error' }, { status: 500 });\n  }\n}\n\nexport async function GET() {\n  const links = await getLinks();\n  return NextResponse.json(links);\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACzC,MAAM,OAAO,MAAM,QAAQ,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;IACjD,MAAM,UAAU,KAAK,OAAO,IAAI,KAAK,GAAG,IAAI,KAAK,QAAQ,IAAI;IAC7D,MAAM,aAAa,KAAK,UAAU,IAAI,KAAK,IAAI,IAAI,KAAK,WAAW;IAEnE,IAAI,CAAC,WAAW,OAAO,SAAS,IAAI,OAAO,IAAI;QAC7C,OAAO,wKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC5E;IAEA,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,iJAAU,EAAC;YAAE,KAAK;YAAS,MAAM;QAAW;QAC/D,OAAO,wKAAY,CAAC,IAAI,CAAC,MAAM;YAAE,QAAQ;QAAI;IAC/C,EAAE,OAAO,KAAU;QACjB,IAAI,IAAI,OAAO,KAAK,eAAe;YACjC,OAAO,wKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QACA,IAAI,IAAI,OAAO,KAAK,iBAAiB,IAAI,OAAO,KAAK,gBAAgB;YACnE,OAAO,wKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,IAAI,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACjE;QACA,OAAO,wKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF;AAEO,eAAe;IACpB,MAAM,QAAQ,MAAM,IAAA,+IAAQ;IAC5B,OAAO,wKAAY,CAAC,IAAI,CAAC;AAC3B"}}]
}